<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <!-- Important: Set Content Security Policy for Electron -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://cdn.jsdelivr.net; style-src 'self' https://cdn.jsdelivr.net; font-src 'self' https://cdn.jsdelivr.net;">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metadata Generator Tool - Desktop Edition</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons for theme switcher -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <style>
        :root {
            --bs-body-font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --bs-border-radius: 0.5rem;
            --bs-border-radius-lg: 0.75rem;
        }
        [data-bs-theme="dark"] {
            --bs-body-bg: #1a1a1a;
            --bs-body-color: #f0f0f0;
            --bs-tertiary-bg: #2c2c2c;
            --bs-border-color: #444;
            --bs-primary: #0d6efd;
        }
        .card { transition: all 0.2s ease-in-out; }
        .card:hover { transform: translateY(-3px); box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2); }
        h1, h2, h3, h4, h5, h6 { font-weight: 300; }
        .form-check-input:checked { background-color: var(--bs-primary); border-color: var(--bs-primary); }
        .progress-bar { background-color: var(--bs-primary); }
        .divider-text { font-weight: 300; }
        .note { font-size: 0.9em; color: var(--bs-secondary-color); }
        .theme-switcher { position: fixed; top: 1rem; right: 1rem; z-index: 1050; }
        .theme-switcher .dropdown-menu { min-width: auto; }
    </style>
</head>
<body>
    <!-- Theme Switcher -->
    <div class="theme-switcher dropdown">
        <button class="btn btn-secondary dropdown-toggle" type="button" id="themeSwitcher" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-circle-half"></i></button>
        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="themeSwitcher">
            <li><button class="dropdown-item" type="button" data-bs-theme-value="light"><i class="bi bi-sun-fill me-2"></i> Light</button></li>
            <li><button class="dropdown-item" type="button" data-bs-theme-value="dark"><i class="bi bi-moon-stars-fill me-2"></i> Dark</button></li>
            <li><button class="dropdown-item" type="button" data-bs-theme-value="auto"><i class="bi bi-circle-half me-2"></i> Auto</button></li>
        </ul>
    </div>

    <div class="container py-5">
        <div class="text-center mb-5">
            <h1 class="display-5">Stock Metadata Generator</h1>
            <p class="lead text-muted">Desktop Edition</p>
        </div>

        <form id="metadataForm">
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <h2 class="h4 card-title text-primary mb-3">1. Select Processing Mode</h2>
                    <div class="text-center bg-body-tertiary p-3 rounded">
                        <div class="form-check form-check-inline fs-5">
                            <input class="form-check-input" type="radio" name="processingMode" id="modeAi" value="ai" checked>
                            <label class="form-check-label" for="modeAi">AI Generate & Process</label>
                        </div>
                        <div class="form-check form-check-inline fs-5">
                            <input class="form-check-input" type="radio" name="processingMode" id="modeManual" value="manual">
                            <label class="form-check-label" for="modeManual">Process Existing Metadata</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <h2 class="h4 card-title text-primary mb-3">2. Configure Your Batch</h2>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="marketplace" class="form-label">Marketplace</label>
                            <select id="marketplace" name="marketplace" class="form-select">
                                <option value="shutterstock">Shutterstock</option>
                                <option value="freepik">Freepik</option>
                                <option value="adobe_stock">Adobe Stock</option>
                                <option value="vecteezy">Vecteezy</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="mediaType" class="form-label">AI Prompt Style</label>
                            <select id="mediaType" name="mediaType" class="form-select">
                                <option value="2D_Vectors">2D Vector Icons</option>
                                <option value="3D_Renders">3D Rendered Icons (JPG/PNG)</option>
                            </select>
                        </div>
                        <div class="col-12">
                            <div id="mediaTypeSpecificStyle" class="alert alert-secondary small p-2">
                                <strong class="d-block">AI Style Description:</strong>
                                <span id="styleDescription"></span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label for="targetFileFormat" class="form-label">Target Output File Format</label>
                            <select id="targetFileFormat" name="targetFileFormat" class="form-select">
                                <option value="eps">.eps</option>
                                <option value="jpg">.jpg</option>
                                <option value="png">.png</option>
                                <option value="svg">.svg</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="sourceFiles" class="form-label">Source Files (.zip)</label>
                            <input type="file" id="sourceFiles" name="epsFiles" accept=".zip" class="form-control">
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Processing Section -->
            <div id="aiProcessingSection">
                <div class="card shadow-sm mb-4">
                    <div class="card-body">
                        <h2 class="h4 card-title text-primary mb-3">3. AI Generation Options</h2>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="geminiApiKey" class="form-label">Gemini API Key (Optional)</label>
                                <input type="text" id="geminiApiKey" name="geminiApiKey" class="form-control" placeholder="Overrides .env file">
                            </div>
                            <div class="col-md-6">
                                <label for="geminiModel" class="form-label">Gemini Model</label>
                                <select id="geminiModel" name="geminiModel" class="form-select">
                                    <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
                                    <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>
                                    <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
                                    <option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="card bg-body-tertiary mt-4">
                            <div class="card-body">
                                <h3 class="h5 mb-3">Local .txt to .csv Converter</h3>
                                <p class="note">Quickly convert a numbered .txt prompt file into a usable .csv without using the AI.</p>
                                <label for="convertTxtInput" class="form-label">Upload .txt File</label>
                                <div class="input-group">
                                    <input type="file" id="convertTxtInput" name="convertTxtInput" accept=".txt" class="form-control">
                                    <button type="button" id="convertTxtToCsvButton" class="btn btn-outline-secondary">Convert</button>
                                </div>
                                <div id="convertTxtStatusMessage" class="mt-2"></div>
                            </div>
                        </div>

                        <hr class="my-4">

                        <h3 class="h5 mb-3">Provide Generation Prompts</h3>
                        <p class="note">Use one of the methods below to provide prompts for the AI.</p>

                        <nav>
                            <div class="nav nav-tabs mb-3" id="nav-tab" role="tablist">
                                <button class="nav-link active" id="nav-manual-tab" data-bs-toggle="tab" data-bs-target="#nav-manual" type="button" role="tab">Manual Input</button>
                                <button class="nav-link" id="nav-file-upload-tab" data-bs-toggle="tab" data-bs-target="#nav-file-upload" type="button" role="tab">File Upload</button>
                            </div>
                        </nav>
                        <div class="tab-content" id="nav-tabContent">
                            <div class="tab-pane fade show active" id="nav-manual" role="tabpanel">
                                <label for="graphicsPrompts" class="form-label">Paste Prompts Here</label>
                                <textarea id="graphicsPrompts" name="graphicsPrompts" rows="8" class="form-control" placeholder="e.g., '1. **Title:**
Description'"></textarea>
                            </div>
                            <div class="tab-pane fade" id="nav-file-upload" role="tabpanel">
                                <label for="graphicsPromptsFile" class="form-label">Upload .txt File</label>
                                <input type="file" id="graphicsPromptsFile" name="graphicsPromptsFile" accept=".txt" class="form-control mb-3">
                                
                                <label for="graphicsPromptsCsvFile" class="form-label">Upload .csv File</label>
                                <input type="file" id="graphicsPromptsCsvFile" name="graphicsPromptsCsvFile" accept=".csv" class="form-control">
                            </div>
                        </div>
                        
                        <hr class="my-4">

                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input" type="checkbox" id="customPromptToggle" name="customPromptToggle">
                            <label class="form-check-label" for="customPromptToggle">Use Custom Master Prompt</label>
                        </div>
                        <textarea id="customMasterPrompt" name="customMasterPrompt" rows="8" class="form-control" style="display: none;" placeholder="Paste your custom master prompt here..."></textarea>
                        
                        <div class="mt-3">
                            <button type="button" id="exportMasterPromptButton" class="btn btn-info">Export Master Prompt Packet</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Manual Processing Section -->
            <div id="manualProcessingSection" style="display: none;">
                <div class="card shadow-sm mb-4">
                    <div class="card-body">
                        <h2 class="h4 card-title text-primary mb-3">3. Existing Metadata Options</h2>
                        <p class="note">Provide your own CSV metadata to perform file renaming and metadata injection without AI calls.</p>
                        
                        <label for="existingMetadataCsv" class="form-label">Upload Existing Metadata .csv</label>
                        <input type="file" id="existingMetadataCsv" name="existingMetadataCsv" accept=".csv" class="form-control">
                        <div class="form-text mb-3">Required columns: "Filename", "Document_Title_For_Exif", "Long_Description_For_Exif", "Keywords".</div>

                        <div class="divider-text my-3">OR</div>

                        <label for="pasteExistingMetadata" class="form-label">Paste CSV Data Here</label>
                        <textarea id="pasteExistingMetadata" name="pasteExistingMetadata" rows="10" class="form-control" placeholder="Paste your CSV data here, including headers."></textarea>
                    </div>
                </div>
            </div>

            <div class="d-grid">
                <button type="submit" id="mainSubmitButton" class="btn btn-primary btn-lg">Generate Metadata & Process Files</button>
            </div>
        </form>

        <div id="statusMessage" class="alert mt-4" style="display: none;"></div>

        <div id="progressBarContainer" class="mt-4" style="display: none;">
            <div class="progress" style="height: 25px;">
                <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                    <span id="progressText" class="text-dark fw-bold">0%</span>
                </div>
            </div>
        </div>

        <div id="exportPacketContainer" class="card mt-4" style="display: none;">
            <div class="card-header">
                <h3 class="h5 mb-0">Exported Master Prompt Packet</h3>
            </div>
            <div class="card-body">
                <p class="card-text">This is the full prompt sent to the AI. Copy or download it for debugging.</p>
                <pre id="exportPacketContent" class="bg-body-tertiary p-3 rounded"></pre>
                <div class="d-flex gap-2 mt-3">
                    <button type="button" id="copyExportPacketButton" class="btn btn-success">Copy Packet</button>
                    <button type="button" id="downloadExportPacketButton" class="btn btn-warning">Download Packet</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Our Renderer Process Script -->
    <script src="./renderer.js"></script>
</body>
</html>